// This file is generated automatically
// To regenerate, see: news-crawl/embedded-reader/README.md
/* eslint-disable no-useless-escape */
export const bundle = `(()=>{"use strict";var e={227:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.replaceAllAnchors=void 0;const o=n(860),r=document.getElementById("__base_url").href;t.replaceAllAnchors=()=>{const e=document.getElementsByTagName("a");for(let t=0;t<e.length;++t){const n=e.item(t);if(!n)continue;let i=n.href.trim();if(i.startsWith(r)&&(i=i.substring(r.length)),n.href="#",0!==i.length)if("#"===i[0]){const e=document.getElementById(i.substring(1));null===e?(console.log("Anchor target not found ",i),n.classList.add("__DISABLED_ANCHOR")):n.addEventListener("click",(()=>{const t=e.getBoundingClientRect();(0,o.sendScrollTo)(t.top)}))}else{const e=new URL(i);if("https:"!==e.protocol&&"http:"!==e.protocol){console.log("Invalid URL in anchor ",i),n.classList.add("__DISABLED_ANCHOR");continue}n.addEventListener("click",(()=>{(0,o.sendNavigateTo)(i)}))}}}},651:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fixImages=void 0;const n=400,o=e=>{let t=e;for(;"P"!==t?.tagName&&"DIV"!==t?.tagName;)if(t=t?.parentElement??null,1!==t?.childNodes.length){let e=0;if(t?.childNodes.forEach((t=>{(t.nodeType!==Node.TEXT_NODE||null!==t.textContent&&t.textContent.trim().length>0)&&e++})),1!==e)return}t.classList.add("__CENTER_IMAGE"),e.addEventListener("load",(()=>{e.offsetWidth<64&&e.offsetHeight<64&&null!==t&&(t.style.display="none")}))};t.fixImages=()=>{let e=" > img:only-child";for(let t=0;t<3;++t)document.querySelectorAll("p"+e).forEach(o),document.querySelectorAll("div"+e).forEach(o),e="> *:only-child"+e;document.querySelectorAll("img").forEach((e=>{(e=>{const t=e.src?.match(/^\\s*(https:\\/\\/miro.medium.com\\/max\\/)(\\d+)(.*)\$/i);if(!t)return;const o=parseInt(t[2]);let r=e.width||n;o>r&&o<=n||(r>n&&(r=n),e.src=t[1]+r.toString()+t[3])})(e),e.addEventListener("error",(()=>{e.style.display="none"}))})),document.querySelectorAll("iframe").forEach((e=>{const t=parseInt(e.getAttribute("width")??""),n=parseInt(e.getAttribute("height")??"");if(0===t||isNaN(t)||0===n||isNaN(n))e.style.display="none";else{const o=window.screen.width,r=o*n/t;e.setAttribute("width",o.toString()),e.setAttribute("height",r.toString())}}))}},860:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendGeometryComputed=t.sendTextAvailable=t.sendHighlightsChanged=t.sendDisplayMenu=t.sendScrollTo=t.sendHeightChanged=t.sendNavigateTo=void 0;const o=n(80);let r;r=window.ReactNativeWebView?(e,t)=>{window.ReactNativeWebView.postMessage(JSON.stringify({msgType:e,payload:t}))}:()=>{},window.ReactNativeWebView&&(console.log=(...e)=>{r(o.Messages.Log,e)},console.warn=(...e)=>{r(o.Messages.Warn,e)},console.error=(...e)=>{r(o.Messages.Error,e)}),t.sendNavigateTo=e=>{r(o.Messages.NavigateTo,e)},t.sendHeightChanged=e=>{r(o.Messages.HeightChanged,e)},t.sendScrollTo=e=>{r(o.Messages.ScrollTo,e)},t.sendDisplayMenu=e=>{r(o.Messages.DisplayMenu,e)},t.sendHighlightsChanged=e=>{r(o.Messages.HighlightsChanged,e)},t.sendTextAvailable=e=>{r(o.Messages.TextAvailable,e)},t.sendGeometryComputed=e=>{r(o.Messages.GeometryComputed,e)}},758:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.align=t.Operation=void 0;const o=n(780);var r;!function(e){e[e.Skip=0]="Skip",e[e.Set=1]="Set"}(r=t.Operation||(t.Operation={}));const i=-1,s=(e,t)=>{const[n,r]=[e.length,t.length];let s=Array(r+1),l=Array(r+1);for(let e=0;e<=r;++e)s[e]=e*i;for(let g=1;g<=n;++g){l[0]=s[0]+i;for(let n=1;n<=r;++n){const r=s[n-1]+(d=e[g-1],a=t[n-1],d!==o.INVALID_WORD_TOKEN&&d===a?1:i),h=s[n]+i,c=l[n-1]+i;l[n]=Math.max(r,h,c)}[s,l]=[l,s]}var d,a;return s},l=(e,t)=>{const[n,o]=[e.length,t.length];if(0===n)return{operations1:Array(o).fill(r.Skip),operations2:Array(o).fill(r.Set),score:o*i};if(0===o)return{operations1:Array(n).fill(r.Set),operations2:Array(n).fill(r.Skip),score:n*i};if(1===n)return((e,t)=>{const n=t.length,o=t.indexOf(e),s=Array(n).fill(r.Set);return-1===o?{operations1:[r.Set,...Array(n-1).fill(r.Skip)],operations2:s,score:i*n}:{operations1:[...Array(o).fill(r.Skip),r.Set,...Array(n-o-1).fill(r.Skip)],operations2:s,score:i*(n-1)+1}})(e[0],t);{const o=Math.trunc(n/2),r=s(e.slice(0,o),t),i=s(e.slice(o).reverse(),[...t].reverse());i.reverse();const d=r.map(((e,t)=>e+i[t])),a=(e=>{const t=e.length;let n=0,o=e[0];for(let r=0;r<t;++r){const t=e[r];t>o&&(o=t,n=r)}return n})(d),g=l(e.slice(0,o),t.slice(0,a)),h=l(e.slice(o),t.slice(a));return{operations1:[...g.operations1,...h.operations1],operations2:[...g.operations2,...h.operations2],score:d[a]}}};t.align=(e,t)=>l(e,t)},391:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.boundingBoxUnion=void 0,t.boundingBoxUnion=(e,t)=>{if(null===e)return t;const n=Math.min(e.x,t.x),o=Math.min(e.y,t.y),r=Math.max(e.right,t.right)-n,i=Math.max(e.bottom,t.bottom)-o;return new DOMRectReadOnly(n,o,r,i)}},528:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.previousTextNode=t.nextTextNode=t.extractTextNodes=t.isValidTextNode=void 0;const n=e=>{let t=e;for(;t.firstChild;)t=t.firstChild;return t},o=e=>{let t=e;for(;t.lastChild;)t=t.lastChild;return t},r=e=>{let t=e;for(;null===t?.nextSibling;)if(t=t.parentNode,!t)return null;for(t=t?.nextSibling??null;null!==t?.firstChild;)t=t?.firstChild??null;return t},i=e=>{let t=e;for(;null===t?.previousSibling;)if(t=t.parentNode,!t)return null;for(t=t?.previousSibling??null;null!==t?.lastChild;)t=t?.lastChild??null;return t};t.isValidTextNode=e=>e.nodeType===Node.TEXT_NODE&&!!e.textContent&&""!==e.textContent,t.extractTextNodes=e=>{const i=[];let s=n(e);const l=o(e);for(;s&&((0,t.isValidTextNode)(s)&&i.push(s),s!==l);)s=r(s);return i},t.nextTextNode=e=>{if(!e)return null;let o=n(e);for(o===e&&(o=r(o));o&&!(0,t.isValidTextNode)(o);)o=r(o);return o},t.previousTextNode=e=>{if(!e)return null;let n=o(e);for(n===e&&(n=i(n));n&&!(0,t.isValidTextNode)(n);)n=i(n);return n}},95:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderSelection=t.extractBoundingBox=void 0;const o=n(860),r=n(391),i=n(525),s=.1;let l=0;const d=(e,t)=>{const n=document.createElement("span");return n.className=t,n.appendChild(document.createTextNode(e)),n},a=(e,t)=>{let n,o=0;"first"===t?n=e[0].firstChild:(n=e[e.length-1].lastChild,o=n.length-1);let r=document.createRange();return r.setStart(n,o),r.setEnd(n,o+1),r.getBoundingClientRect()},g=(e,t,n,o,r=4,i=6)=>new DOMRectReadOnly(e-i,t-r,n-e+2*i,o-t+2*r);t.extractBoundingBox=(e,t,n)=>{const s="__BB_CALC"+l++;(0,i.changeHighlightInWordRange)(t,n,"set",(e=>d(e,s)));const h=document.querySelectorAll("."+s);if(0===h.length)return;let c=null;h.forEach((e=>c=(0,r.boundingBoxUnion)(c,e.getBoundingClientRect())));const u=a(h,"first"),f=a(h,"last");let p;if(u.bottom===f.bottom)p={firstLine:g(c.x,c.y,c.right,c.bottom)};else{const e=g(u.x,u.y,c.right,u.bottom),t=g(c.x,f.y,f.right,f.bottom);p=c.height<=e.height+t.height?{firstLine:e,lastLine:t}:{firstLine:e,lastLine:t,middle:g(c.x,u.bottom,c.right,f.y,0)}}(0,o.sendGeometryComputed)({id:e,selectionGeometry:p}),(0,i.changeHighlightInWordRange)(t,n,"unset",(e=>d(e,s)))};const h=["TopLeft","TopRight"],c=["BottomLeft","BottomRight"],u=[...h,...c];t.renderSelection=e=>{const t=[];if(e.lastLine)if(e.middle){const n=[];e.middle.left<e.firstLine.left-s&&n.push("TopLeft"),e.middle.right>e.lastLine.right+s&&n.push("BottomRight"),t.push(...f(e.firstLine,h)),t.push(...f(e.middle,n)),t.push(...f(e.lastLine,c))}else{const n=[...h],o=[...c];e.firstLine.left>e.lastLine.right+s&&n.push("BottomLeft"),e.firstLine.right>e.lastLine.right+s&&n.push("BottomRight"),e.lastLine.left<e.firstLine.left-s&&o.push("TopLeft"),e.lastLine.right<e.firstLine.left-s&&o.push("TopRight"),t.push(...f(e.firstLine,n)),t.push(...f(e.lastLine,o))}else t.push(...f(e.firstLine,u));return()=>{for(const e of t)e.remove()}};const f=(e,t)=>{if(!e)return[];const n=document.createElement("div"),o=document.createElement("div");for(const r of[n,o]){const n=r.style;n.position="absolute",n.left=e.left+"px",n.top=e.top+"px",n.width=e.right-e.left+"px",n.height=e.bottom-e.top+"px";for(const e of t)n[\`border\${e}Radius\`]="6px"}return n.style.backgroundColor="var(--highlight)",n.style.zIndex="-1",o.style.boxShadow="0 3px 10px rgba(0, 0, 0, 0.2)",o.style.zIndex="-2",document.body.appendChild(o),document.body.appendChild(n),[o,n]}},525:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertRanges=t.getAllHighlightedWordRanges=t.changeHighlightInRange=t._nextWordNode=t._firstWordNode=t.changeHighlightInWordRange=void 0;const o=n(860),r=n(758),i=n(528),s=n(780),l=(e,t)=>{for(const n of t){const t=[];let o=!1,r="";for(const i of n.words)if(o)if(i.highlight&s.HighlightTypeBits.SuffixSpaces)r+=i.text;else{const n=i.text.match(p);let s="";n?(r+=n[1]+n[2],s=n[3]):r+=i.text,""!==r&&(t.push(e(r)),r=s),o=!1}else if((0,s.isHighlighted)(i.highlight)){const n=i.text.match(p);let l="",d="",a="";n?(i.highlight&s.HighlightTypeBits.PrefixSpaces?d=n[1]:l=n[1],d+=n[2],i.highlight&s.HighlightTypeBits.SuffixSpaces?d+=n[3]:a=n[3]):d=i.text,r+=l,""!==r&&t.push(document.createTextNode(r)),0==(i.highlight&s.HighlightTypeBits.SuffixSpaces)?(t.push(e(d)),r=a):(r=d,o=!0)}else r+=i.text;""!==r&&(o?t.push(e(r)):t.push(document.createTextNode(r))),n.element.replaceChildren(...t)}},d=(e,t,n)=>{e.highlight!==t&&(e.highlight=t,n.add(e.wordList))},a=(e,t,n,o)=>!(!n||!(0,s.isHighlighted)(n.highlight)||(d(n,t?n.highlight|e:n.highlight&~e,o),0)),g=(e,t)=>{if(!(0,s.isHighlighted)(t[e].highlight))return{text:null,wordRange:{fromWord:e,toWord:e}};let n,o;for(n=e-1;n>-1&&(0,s.isHighlighted)(t[n].highlight);--n);for(n++,o=e+1;o<t.length&&(0,s.isHighlighted)(t[o].highlight);++o);return{text:t.map(((e,t)=>t>=n&&t<o?e.text:"")).join("").trim(),wordRange:{fromWord:n,toWord:o}}};t.changeHighlightInWordRange=({fromWord:e,toWord:t},n,o="default",r=(e=>((e,t)=>{const n=document.createElement("span");n.className="__HIGHLIGHT";const o=document.createTextNode(e);let r,i;return n.appendChild(o),n.addEventListener("touchstart",(e=>{e.touches.length>1?(r=null,i=null):(r={x:e.touches[0].pageX,y:e.touches[0].pageY},i=(new Date).getTime())}),!1),n.addEventListener("touchend",(e=>{if(null!==r&&null!==i&&0===e.touches.length&&1===e.changedTouches.length){const n=r.x-e.changedTouches[0].pageX,s=r.y-e.changedTouches[0].pageY,l=(new Date).getTime()-i;n*n+s*s<10&&l<250&&f(o,t)}r=null,i=null}),!1),n})(e,n)))=>{const i=t-e;if(0===i)return null;let h=0;for(let o=e;o<t;++o)(0,s.isHighlighted)(n[o].highlight)||h++;const c="unset"!==o&&("set"===o||h>3||h>=i-h),u=new Set,p=a(s.HighlightTypeBits.SuffixSpaces,c,n[e-1],u),x=a(s.HighlightTypeBits.PrefixSpaces,c,n[t],u),m=c?s.HighlightTypeBits.Word|(p?s.HighlightTypeBits.PrefixSpaces:0)|(i>1||x?s.HighlightTypeBits.SuffixSpaces:0):s.HighlightType.None;if(d(n[e],m,u),1===i)return l(r,u),c?g(e,n):{text:null,wordRange:{fromWord:e,toWord:t}};const T=c?s.HighlightTypeBits.Word|s.HighlightTypeBits.PrefixSpaces|(x?s.HighlightTypeBits.SuffixSpaces:0):s.HighlightType.None;d(n[t-1],T,u);const N=c?s.HighlightType.Full:s.HighlightType.None;for(let o=e+1;o<t-1;++o)d(n[o],N,u);return l(r,u),c?g(e,n):{text:null,wordRange:{fromWord:e,toWord:t}}},t._firstWordNode=(e,t)=>{if(0===e.length)throw new Error("Cannot find first word.");t=t??e[0].wordList;let n=0;for(;n<e.length&&e[n].wordList!==t;)n++;const o=(0,i.nextTextNode)(t.element);if(n===e.length||!o)throw new Error("Cannot find first word.");return{words:e,wordIndex:n,indexInWordText:0,textNode:o,indexInTextNode:0}},t._nextWordNode=({words:e,wordIndex:t,indexInWordText:n,textNode:o,indexInTextNode:r})=>{const s=e[t].text.length-n,l=(o.textContent?.length??0)-r;if(s<l)return t===e.length-1?null:{words:e,wordIndex:t+1,indexInWordText:0,textNode:o,indexInTextNode:r+s};if(s===l){const n=(0,i.nextTextNode)(o);return n&&{words:e,wordIndex:t+1,indexInWordText:0,textNode:n,indexInTextNode:0}}{const r=(0,i.nextTextNode)(o);return r&&{words:e,wordIndex:t,indexInWordText:n+l,textNode:r,indexInTextNode:0}}};const h=(e,n,o)=>{let r=(0,t._nextWordNode)(e);for(;;){if(r?.textNode===n&&r.indexInTextNode>o||e.textNode===n&&r?.textNode!==n)return e;if(!r)throw new Error("Cannot advance to node and offset");e=r,r=(0,t._nextWordNode)(r)}},c=(e,n,o)=>{const r=e.words[n].text.length,i=(e,t)=>(o&&(e.indexInTextNode+=t,e.indexInWordText+=t),e);let s={...e};for(;;){if(!s)throw new Error("Cannot advance to word");if(s.wordIndex===n){const e=(s.textNode.textContent?.length??0)-s.indexInTextNode,t=r-s.indexInWordText;if(e>=t)return i(s,t)}s=(0,t._nextWordNode)(s)}};t.changeHighlightInRange=(e,n,o)=>{let r,s,l,d;(0,i.isValidTextNode)(e.startContainer)?(r=e.startContainer,l=e.startOffset):(r=(0,i.nextTextNode)(e.startContainer),l=0),(0,i.isValidTextNode)(e.endContainer)?(s=e.endContainer,d=e.endOffset):(s=(0,i.previousTextNode)(e.endContainer),d=s?.textContent?.length??0);const a=((e,t)=>{let n=null;for(;null===n;){if(null===e)return null;n=t.get(e)??null,e=e.parentNode}return n})(r,n);if(!a||!r||!s)return null;let g=(0,t._firstWordNode)(o,a);g=h(g,r,l);const c=g.wordIndex;g=h(g,s,d-1);const f={fromWord:c,toWord:g.wordIndex+1},p=(0,t.changeHighlightInWordRange)(f,o);return p?{range:u(p.wordRange,o),selection:p}:null};const u=(e,n)=>{const o=(0,t._firstWordNode)(n),r=c(o,e.fromWord),i=c(r,e.toWord-1,!0);if(!r||!i)throw new Error("Cannot find output range when highlighting");const s=document.createRange();return s.setStart(r.textNode,r.indexInTextNode),s.setEnd(i.textNode,i.indexInTextNode),s},f=(e,n)=>{let r=(0,t._firstWordNode)(n);r=h(r,e,0);const i=g(r.wordIndex,n),s=u(i.wordRange,n);(0,o.sendDisplayMenu)({selection:i,selectionRect:s.getBoundingClientRect()})};t.getAllHighlightedWordRanges=e=>{const t=[];let n=null;for(let o=0;o<e.length;++o)(0,s.isHighlighted)(e[o].highlight)?null===n&&(n={fromWord:o,toWord:-1},t.push(n)):null!==n&&(n.toWord=o,n=null);return null!==n&&(n.toWord=e.length),t},t.convertRanges=(e,t,n,o)=>{if(t.length!==n.length)return console.error("Should have as many words as tokens!"),null;if(n.length===o.length){let e;for(e=0;e<t.length&&n[e]===o[e];++e);if(e===t.length)return null}const i=(0,r.align)(n,o);if(i.operations1.length!==i.operations2.length)return console.error("Internal error: alignments should have same length"),null;const s=new Map,l=new Map;let[d,a,g]=[0,0,0];for(let e=0;e<i.operations1.length;++e)i.operations1[e]===r.Operation.Set&&(s.set(d,a),l.set(d,g),++d),i.operations2[e]===r.Operation.Set&&++a,i.operations1[e]===r.Operation.Set&&(g=a);s.set(d,a),l.set(d,g);const h=[],c=[];for(const r of e){const e=r.toWord-r.fromWord;if(0===e)continue;const i=s.get(r.fromWord),u=l.get(r.toWord);let f=0,p=0;for(g=i??0,d=r.fromWord;d<r.toWord;++d)a=s.get(d)??0,p+=Math.max(0,a-g),g=a+1,a<o.length&&n[d]===o[a]&&++f;void 0===i||void 0===u||f/e<.75||p/e>1?h.push(t.slice(r.fromWord,r.toWord).join("").trim()):c.push({fromWord:i,toWord:u})}return{lostQuotes:h,wordRanges:c}};const p=/^(\\s*)(.*?)(\\s*)\$/},780:(e,t)=>{var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.splitInSentences=t.isSentenceBreakWord=t.tokenizeWord=t._tokenizeCoreWord=t._normalizeWord=t.calculateNodeToWordListMap=t.flattenMap=t.extractWordLists=t.isHighlighted=t.HighlightType=t.HighlightTypeBits=t.newTokenizationContext=t.FIRST_TOKEN=t.SPACE_TOKEN=t.INVALID_WORD_TOKEN=void 0,t.INVALID_WORD_TOKEN=0,t.SPACE_TOKEN=1,t.FIRST_TOKEN=2,t.newTokenizationContext=()=>({stringToToken:new Map,tokenToString:new Map([[t.INVALID_WORD_TOKEN,""]]),nextToken:t.FIRST_TOKEN}),(o=t.HighlightTypeBits||(t.HighlightTypeBits={}))[o.Word=1]="Word",o[o.PrefixSpaces=2]="PrefixSpaces",o[o.SuffixSpaces=4]="SuffixSpaces",function(e){e[e.None=0]="None",e[e.WordOnly=1]="WordOnly",e[e.WordAndPrefixSpaces=3]="WordAndPrefixSpaces",e[e.WordAndSuffixSpaces=5]="WordAndSuffixSpaces",e[e.Full=7]="Full"}(n=t.HighlightType||(t.HighlightType={})),t.isHighlighted=e=>e!==n.None;const r=(e,o,r,i)=>{const s=e.substring(i.textStart,i.textEnd),l=e.substring(i.wordStart,i.wordEnd);o.words.push({text:s,token:(0,t._tokenizeCoreWord)(l,r),wordList:o,highlight:n.None})},i=(e,t)=>{const n=[],o=t.matchAll(c);let r=null,i=null;for(const t of o){const o=e+(t.index??0),s=o+t[0].length;null!==i&&n.push({textStart:i.spaceStart,wordStart:i.spaceEnd,wordEnd:o,textEnd:o}),i={spaceStart:o,spaceEnd:s},null===r?r={firstSpaceStart:o,lastSpaceStart:o,separators:n}:r.lastSpaceStart=o}return r};t.extractWordLists=(e,t)=>{const n=[];for(const o of e){let e=o.parentElement;if(!e){console.warn("Text Node has no parent element, ignoring!");continue}if(1!==e.childNodes.length){const t=document.createElement("span");e.replaceChild(t,o),t.appendChild(o),e=t}const s={element:e,words:[]};n.push(s);const l=o.textContent??"",d=l.matchAll(g);let a=null,h=null;for(const e of d){const n=e.index??0,o=e[0];h=i(n,o);const d=n,g=d+o.length,c=h?.firstSpaceStart??g,u=h?.lastSpaceStart??(0===n?0:g);null===a?(a={textStart:0,wordStart:0,wordEnd:d,textEnd:c},0!==n?r(l,s,t,a):h?.firstSpaceStart&&(a.wordEnd=c,r(l,s,t,a))):(a.wordEnd=d,a.textEnd=c,r(l,s,t,a)),h&&h.separators?.forEach((e=>{r(l,s,t,e)})),a={textStart:u,wordStart:g}}const c=a?.textStart??0,u=a?.wordStart??0,f=l.length,p=f;if(c!==p)if(u===f){const e=s.words[s.words.length-1],n=l.substring(c,p);e&&""===n.trim()?e.text+=n:r(l,s,t,{textStart:c,wordStart:c,wordEnd:f,textEnd:p})}else r(l,s,t,{textStart:c,wordStart:u,wordEnd:f,textEnd:p})}return n},t.flattenMap=function(e,t){let n=[];return e.forEach((e=>{n=n.concat(e.words.map(t))})),n},t.calculateNodeToWordListMap=e=>{const t=new Map;return e.forEach((e=>{t.set(e.element,e)})),t},t._normalizeWord=(e,t)=>{let n=e.replace(u,"'").normalize("NFKD").replace(f,"").toUpperCase();if(!n.match(N)){if(t)return t;n=n.replace(p,"-"),n=n.replace(x,'"'),n=n.replace(m,"("),n=n.replace(T,")"),n=n.split("").map((e=>S[e]??e)).join("")}return n},t._tokenizeCoreWord=(e,n)=>{if(""===e)return t.INVALID_WORD_TOKEN;const o=(0,t._normalizeWord)(e);if(""===o)return t.SPACE_TOKEN;const r=n.stringToToken.get(o);return void 0!==r?r:(n.stringToToken.set(o,n.nextToken),n.tokenToString.set(n.nextToken,o),n.nextToken++)},t.tokenizeWord=(e,n)=>{if(""===e)return t.INVALID_WORD_TOKEN;const o=e.match(h);return o&&0!==o[2].length?(0,t._tokenizeCoreWord)(o[2],n):(0,t._tokenizeCoreWord)(e,n)},t.isSentenceBreakWord=e=>{const t=e.trimEnd();return 0!==t.length&&d.includes(t[t.length-1])};const s=["span","a","abbr","b","strong","summary","th","em","i","dfn","q","var","cite","u","sub","sup","ins","mark","del","s","center","code","kbd","samp","tt"],l=e=>(e=>s.includes(e.tagName.toLowerCase()))(e)?l(e.parentElement):e;t.splitInSentences=e=>{const n=[];let o,r;for(const i of e){const e=l(i.element);e!==o&&(o=e,r=void 0);for(const e of i.words)r||(r=[],n.push(r)),r.push(e.text),(0,t.isSentenceBreakWord)(e.text)&&(r=void 0)}return n};const d=".․﹒．!?՜՞։؟۔܀܁܂߹।॥၊။።፧፨᙮᜵᜶᠃᠉᥄᥅᪨᪩᪪᪫᭚᭛᭞᭟᰻᰼᱾᱿‼‽⁇⁈⁉⸮¡¿。꓿꘎꘏꛳꛷꡶꡷꣎꣏꤯꧈꧉꩝꩞꩟꫰꫱꯫﹖﹗！？｡𐩖𐩗𑁇𑁈𑂾𑂿𑃀𑃁𑅁𑅂𑅃𑇅𑇆",a=\`[\${d}]|\\\\p{Punctuation}|\\\\p{Sc}|\\\\p{Sk}|\\\\p{Sm}\`,g=new RegExp(\`(\${a}|\\\\s)+\`,"gu"),h=new RegExp(\`^(\${a}|\\\\s)*(.*?)(\${a}|\\\\s)*\$\`,"u"),c=/\\s+/gu,u=/[ʼ՚ߴߵ＇´]/gu,f=/(\\p{Cc}|\\p{Diacritic}|\\s)/gu,p=/(\\p{Pd}|\\p{Pc})/gu,x=/([‚„❛❜❝❞❮❯〝〞〟＂]|\\p{Pi}|\\p{Pf})/gu,m=/\\p{Ps}/gu,T=/\\p{Pe}/gu,N=/^[A-Z0-9!"#\$%&'*+,./:;<=>?@\\\\|~()-]*\$/gu,S={"⁄":"/","∕":"/",Æ:"AE",Ð:"D",Ø:"O",Đ:"D",Ħ:"H",ĸ:"K",Ł:"L",Ŋ:"N",Œ:"OE",Ŧ:"T",Ƀ:"B",Ɓ:"B",Ƃ:"B",Ƈ:"C",Ɖ:"D",Ɗ:"D",Ƌ:"D",ƍ:"G",Ǝ:"E",Ə:"E",Ɛ:"E",Ƒ:"F",Ɠ:"G",Ƕ:"HV",Ɩ:"I",Ɨ:"I",Ƙ:"K",Ƚ:"L",ƛ:"Λ",Ɲ:"N",Ƞ:"N",Ɵ:"O",Ƣ:"G",Ƥ:"P",Ʀ:"R",ƫ:"T",Ƭ:"T",Ʈ:"T",Ʋ:"V",Ƴ:"Y",Ƶ:"Z",ƻ:"2",Ƽ:"5",Ǣ:"AE",Ǥ:"G",Ǯ:"3",Ǽ:"AE",Ǿ:"O",ȡ:"D",Ȣ:"OU",Ȥ:"Z",ȴ:"L",ȵ:"N",ȶ:"T",ȷ:"J",ȸ:"DB",ȹ:"QP",Ⱥ:"A",Ȼ:"C",Ⱦ:"T",Ȿ:"S",Ɀ:"Z",Ʉ:"U",Ɇ:"E",Ɉ:"J",Ɋ:"Q",Ɍ:"R",Ɏ:"Y",ẞ:"SS",Ỻ:"LL",Ỿ:"Y",Ɐ:"A",Ɑ:"A",Ɒ:"A",ɕ:"C",ɘ:"E",ɚ:"E",Ɜ:"E",ɝ:"E",ɞ:"E",ɟ:"J",Ɡ:"G",ɢ:"G",Ɥ:"H",Ɦ:"H",ɧ:"H",Ɪ:"I",Ɫ:"L",Ɬ:"L",ɭ:"L",ɰ:"M",Ɱ:"M",ɳ:"N",ɴ:"N",ɶ:"OE",ɷ:"O",ɸ:"P",ɹ:"R",ɺ:"R",ɻ:"R",ɼ:"R",Ɽ:"R",ɾ:"R",ɿ:"R",ʁ:"R",Ʂ:"S",ʄ:"J",ʅ:"S",ʆ:"S",Ʇ:"T",ʍ:"W",ʎ:"Y",ʏ:"Y",ʐ:"Z",ʑ:"Z",ʗ:"C",ʙ:"B",ʚ:"E",ʛ:"G",ʜ:"H",Ʝ:"J",Ʞ:"K",ʟ:"L",ʠ:"Q",ʣ:"DZ",ʤ:"DZ",ʥ:"DZ",ʦ:"TS",ʧ:"TS",ʨ:"TC",ʩ:"FN",ʪ:"LS",ʫ:"LZ",ʬ:"WW",ʮ:"H",ʯ:"H",Ϗ:"K",Ͱ:"H",Ͳ:"T",Ͷ:"W",Ͻ:"C",Ͼ:"C",Ͽ:"C",Α:"A",Ε:"E",Η:"H",Ι:"I",Ο:"O",Υ:"Y",Β:"B",Ζ:"Z",Κ:"K",Μ:"M",Ν:"N",Ρ:"P",Τ:"T",Χ:"X",Ϙ:"Q",Ϝ:"F",Ϳ:"J","϶":"E",Ϻ:"M",ϼ:"P",ᴩ:"P",Е:"E",Ђ:"H",Є:"E",Ѕ:"S",І:"I",Ј:"J",Љ:"JB",Њ:"HB",Ћ:"TH",К:"K",И:"N",У:"Y",А:"A",Б:"B",В:"B",М:"M",Н:"H",О:"O",Р:"P",С:"C",Т:"T",Х:"X",Ъ:"B",Ь:"B",Э:"E",Я:"R",Ѣ:"B",Ѵ:"V",Ѹ:"OY",Ҋ:"N",Ҍ:"B",Ҏ:"P",Ғ:"F",Ҕ:"H",Қ:"K",Ҝ:"K",Ҟ:"K",Ҡ:"K",Ң:"H",Ҥ:"H",Ҩ:"O",Ҫ:"C",Ҭ:"T",Ү:"Y",Ұ:"Y",Ҳ:"X",Ҷ:"H",Ҹ:"H",Һ:"H",Ҽ:"E",Ҿ:"E",Ӏ:"I",Ӄ:"K",Ӈ:"H",Ӊ:"H",Ӌ:"H",Ӎ:"M",Ӕ:"AE",Ә:"E",Ӻ:"F",Ӽ:"X",Ԁ:"D",Ԃ:"DJ",Ԋ:"HV",Ԍ:"G",Ԑ:"E",Ԙ:"RE",Ԛ:"Q",Ԝ:"W",Ԟ:"K",Ԥ:"P",Ԧ:"H"}},511:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.registerBoundingBoxListener=t.registerHighlightListener=t.initWords=void 0;const o=n(860),r=n(391),i=n(528),s=n(95),l=n(525),d=n(780),a=e=>e.replace(/[^a-zA-Z0-9]/g,"");let g=null,h=null,c=null;const u={};t.initWords=()=>{h=(0,d.newTokenizationContext)();const e=(0,d.extractWordLists)((0,i.extractTextNodes)(document.body),h);c=e.flatMap((e=>e.words)),g=(0,d.calculateNodeToWordListMap)(e),(0,o.sendTextAvailable)((0,d.splitInSentences)(e))};let f=null;const p=()=>{null!==f&&clearTimeout(f),f=setTimeout((()=>{f=null,c&&(0,o.sendHighlightsChanged)({words:c.map((e=>e.text)),wordRanges:(0,l.getAllHighlightedWordRanges)(c)})}),500)},x=(e,t)=>{if(!c||!h)return void console.error("Setting highlights before words and context are obtained");const n=e.map((e=>h?(0,d.tokenizeWord)(e,h):d.INVALID_WORD_TOKEN)),o=(0,l.convertRanges)(t,e,n,c.map((e=>e.token))),r=o?o.wordRanges:t;for(const e of r)(0,l.changeHighlightInWordRange)(e,c);o&&p()};t.registerHighlightListener=()=>{window.onRemoveHighlight=e=>{c&&((0,l.changeHighlightInWordRange)(e,c,"unset"),p())},window.onSetHighlights=x,window.goToHighlightElemPos=e=>{const t=document.getElementsByClassName("__HIGHLIGHT"),n=a(e),r=[];let i=Number.POSITIVE_INFINITY,s=-1;Array.from(Array(t.length)).forEach(((e,n)=>{const o=t[n].textContent??"",s=a(o);r.push(s),i=Math.min(s.length,i)}));const l=n.substring(0,i);for(const e in r){const t=parseInt(e);if(r[t].startsWith(l)&&r.slice(t).join("").startsWith(n)){s=t;break}}if(s>-1){const e=t[s].getBoundingClientRect();(0,o.sendScrollTo)(e.top+100)}else console.warn("Cannot find the highlight")},window.addEventListener("touchend",(()=>{const e=window.getSelection();if("Range"!==e?.type)return;const t=[];for(let n=0;n<e.rangeCount;++n)t.push(e.getRangeAt(n));e.removeAllRanges(),setTimeout((()=>{let e=null,n=null;for(const o of t)if(g&&c){const t=(0,l.changeHighlightInRange)(o,g,c);t&&(i=e,s=t.selection,e=null===i?s:{text:(i.text??"")+(s.text??""),wordRange:{fromWord:Math.min(i.wordRange.fromWord,s.wordRange.fromWord),toWord:Math.max(i.wordRange.toWord,s.wordRange.toWord)}},n=(0,r.boundingBoxUnion)(n,t.range.getBoundingClientRect()))}var i,s;e&&e.text&&n&&(0,o.sendDisplayMenu)({selection:e,selectionRect:n}),p(),document.body.style.setProperty("-webkit-user-select","none"),setTimeout((()=>{document.body.style.setProperty("-webkit-user-select","auto")}),100)}),1)}))},t.registerBoundingBoxListener=()=>{window.onExtractBoundingBox=(e,t)=>{c&&(0,s.extractBoundingBox)(e,t,c)},window.onHighlightBlock=(e,t)=>{u[e]?.(),u[e]=(0,s.renderSelection)(t)},window.onUnhighlightBlock=e=>{u[e]?.()},window.onDeleteBlock=e=>{u[e]?.(),delete u[e]}}},80:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Messages=void 0,(n=t.Messages||(t.Messages={})).Log="LOG",n.Warn="WARN",n.Error="ERROR",n.HeightChanged="HEIGHT_CHANGED",n.DisplayMenu="DISPLAY_MENU",n.NavigateTo="NAVIGATE_TO",n.ScrollTo="SCROLL_TO",n.HighlightsChanged="HIGHLIGHTS_CHANGED",n.TextAvailable="TEXT_AVAILABLE",n.GeometryComputed="GEOMETRY_COMPUTED"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{const e=n(227),t=n(511),o=n(651),r=n(860),i=()=>{(0,r.sendHeightChanged)(document.body.scrollHeight)};window.onLoadingComplete=()=>{i();const n=new ResizeObserver(i);(0,o.fixImages)(),n.observe(document.body),(0,e.replaceAllAnchors)(),(0,t.initWords)(),(0,t.registerBoundingBoxListener)()}})()})();`
